<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>СЫРОДЕЛИЕ.РФ - автоматическая камера созревания</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="font-awesome-4.6.3/css/font-awesome.css" />
    <link rel="stylesheet" href="bootstrap-3.3.6/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/animate.css" />
    <link rel="stylesheet" href="fonts/fonts.css" />
  </head>
  <body onload="getCurTemp(), getCurHum()">
    <nav class="navbar navbar-trans navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapsible">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span
            </button>
            <!--a class="navbar-brand text-danger" href="/">ХОЗЯИН</a-->
        </div>
        <div class="navbar-collapse collapse" id="navbar-collapsible">
            <ul class="nav navbar-nav navbar-left">
				<li>&nbsp;</li>
                <li><a href="#section1"><i class="fa fa-home" aria-hidden="true"></i>&nbsp;Старт</a></li>
                <li><a href="#section2"><i class="fa fa-bar-chart" aria-hidden="true"></i>&nbsp;Данные</a></li>
                <li><a href="#section4"><i class="fa fa-cog fa-spin fa-fw"></i>&nbsp;Камера</a></li>
                <li>&nbsp;</li>
            </ul>
        </div>
    </div>
	</nav>

<section class="container-fluid" id="section1">
    <div class="v-center">
        <h2 class="text-center roboto">СЫРОДЕЛИЕ.РФ<hr/></h2>
        <h1 class="text-center lato  animate slideInDown"><a href="tel:88005055312" class="main-phone">8&nbsp;800&nbsp;505&nbsp;53&nbsp;12</a></h1>
        <p class="text-center">
            <br>
            <a href="#section2" class="btn btn-danger btn-lg btn-huge" ><i class="fa fa-bar-chart" aria-hidden="true"></i>&nbsp;Данные из камеры</a>
        </p>
        <p class="text-center">
            <br>
            <a href="#section4" class="btn btn-danger btn-lg btn-huge" ><i class="fa fa-cog fa-spin fa-fw"></i>&nbsp;Задать параметры</a>
        </p>
    </div>
</section>

<section class="container-fluid" id="section2" onload="getTempPar(), getHumPar()">
    <div class="row">
        <div class="col-md-12">
            <h1 class="text-center">Актуальные данные</h1>
            <div class="text-center">Показания датчиков в реальном времени</div>
            <div id="cam-param" class="text-center"></div>
            <br>
        </div>
    </div>
<div class="row">
    <div class="container animate slideInDown ">
        <div class="row">
            <div class="col-sm-6">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="panel panel-default animate slideInDown">
                            <div class="panel-heading">
								<label>Температура:</label>
								<div class="big"><span id="temp"></span>C&deg;</div>
                            </div>
                        </div>
                    </div>
                </div>
              </div>
            <div class="col-sm-6">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="panel panel-default slideInUp animate">
                            <div class="panel-heading">
								<label>Влажность:</label>
								<div class="big"><span id="hum"></span>%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </div>
    
        </div>
    <!--/container-->
</section>

<section id="section4">
    <div class="container v-center">
        <div class="row">
            <div class="col-md-12">
                <h1 class="text-center">Камера созревания</h1>
                <div class="text-center">Установите необходимые вам значения температуры и влажности и включите устройство</div>
                <div id="cam-param" class="text-center"></div>
                <hr>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="row form-group">
					<form id="camera-params">
						<div class="col-md-4">
							<label>Температура:</label>
							<input type="number" class="form-control" id="temperature" name="temperature" min="5" max="16" step="0.5"/>
						</div>
						
						<div class="col-md-4">
							<label>Влажность:</label>
							<input type="number" class="form-control" id="humidity" name="humidity" min="40" max="96" step="0.5"/>
						</div>
						
						 <div class="col-md-4">
							<label>&nbsp;</label>
							<input type="submit" id="submit-params" class="btn btn-default form-control" value="Установить">
						</div>
					</form>
				</div>
				
			</div>
        </div>
        <hr/>
			<div id="process" class="text-center">
				<p id="processon" class="btn btn-danger btn-lg btn-huge lato" >
					<i class="fa fa-cog fa-spin fa-fw"></i>&nbsp;Включить
				</p>
				<p id="processoff" style="display: none"  class="btn btn-lg btn-huge lato off" >
					<i class="fa fa-spinner fa-spin fa-fw"></i>&nbsp;Выключить
				</p>
			</div>
</section>


<footer id="footer">
    <div class="container">
		<br />
        <p class="text-center">Контролировать процесс можно со смартфона, планшета, ноутбука или стационарного компьютера.<br/><a href="http://сыроделие.рф">сыроделие.рф ©2016</a></p>
    </div>
</footer>

    <!--scripts loaded here-->
    
    <script src="jquery1.12.4/jquery.js"></script>
    <script src="bootstrap-3.3.6/dist/js/bootstrap.js"></script>
    
    <script src="js/scripts.js"></script>
	<script>
	function getCurTemp() {
		nocache = "&nocache=" + Math.random() * 1000000;
		var request = new XMLHttpRequest();
		request.onreadystatechange = function() {
			if (request.readyState === 4) {
				if (request.status === 200) {
					document.getElementById('temp').innerHTML = request.responseText;
				} else {
					alert("Что то пошло не так, попробуйте перезагрузить страницу.");
				}
			}
		};
		request.open('POST', '/select_current_temp.py', true);
		request.send(null);
		setTimeout('getCurTemp()', 4000);
		return false;  // Prevent the default button action
		
	}
	
	function getCurHum() {
		nocache = "&nocache=" + Math.random() * 1000000;
		var request = new XMLHttpRequest();
		request.onreadystatechange = function() {
			if (request.readyState === 4) {
				if (request.status === 200) {
					document.getElementById('hum').innerHTML = request.responseText;
				} else {
					alert("Что то пошло не так, попробуйте перезагрузить страницу.");
				}
			}
		};
		request.open('POST', '/select_current_hum.py', true);
		request.send(null);
		setTimeout('getCurHum()', 4000);
		return false;
		
	}
	
//	function toggle_visibility(id) {
//		var e = document.getElementById(id);
//		if( e.style.display == 'block' )
//			e.style.display = 'none';
//		else
//			e.style.display = 'block';
//	}
	$("#process p").click(function() {
		$("#process p").toggle();
	});
	
	$(document).ready(function getHumPar() {
		nocache = "&nocache=" + Math.random() * 1000000;
		var request = new XMLHttpRequest();
		request.onreadystatechange = function() {
			if (request.readyState === 4) {
				if (request.status === 200) {
					var x = request.responseText;
					x = parseFloat(x);
					document.getElementById('humidity').value = x;
				} else {
					alert("Что то пошло не так, попробуйте перезагрузить страницу.");
				}
			}
		};
		request.open('POST', '/get_hum_par.py', true);
		request.send(null);
		return false;
	});
		
	$(document).ready(function getTempPar() {
		nocache = "&nocache=" + Math.random() * 1000000;
		var request = new XMLHttpRequest();
		request.onreadystatechange = function() {
			if (request.readyState === 4) {
				if (request.status === 200) {
					var x = request.responseText;
					x = parseFloat(x);
					document.getElementById('temperature').value = x;
					
				} else {
					alert("Что то пошло не так, попробуйте перезагрузить страницу.");
				}
			}
		  };
		request.open('POST', '/get_temp_par.py', true);
		request.send(null);
		return false;
	});
	
	$("#processon").click(function processOn() {
		$.get("processon.py");
	});
	
	$("#processoff").click(function processOff() {
		$.get("processoff.py");
	});
	
	$("#camera-params").submit(function (Event) {
		Event.preventDefault()
		var temperature = $("#temperature").val();
		var humidity = $("#humidity").val();
			$.get("set_params.py", { "temperature" : temperature, "humidity" : humidity } ).done(function(html) { document.getElementById("cam-param").innerHTML = ("Значения успешно установлены, ваше устройство готово к работе");});
	});

	
	$("#submit-params").click(function() {
		$("#cam-param").fadeOut( 6000 );
	});
	</script>
 
  </body>
</html>
